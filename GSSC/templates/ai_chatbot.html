{% extends "base.html" %}
{% block title %}Solar AI Assistant{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-7 col-lg-5">

        <div class="solar-card fade-in">

            <h4 class="text-center mb-3 glow">
                ðŸ¤– Solar AI Assistant
            </h4>

            <div id="chatBox"
                 style="height:320px; overflow-y:auto; background:#020617;
                        border-radius:18px; padding:15px; font-size:14px;">
            </div>

            <div class="input-group mt-3">
                <input id="userMsg" type="text" class="form-control"
                       placeholder="Ask about solar panels, costs, savings..."
                       style="border-radius:25px 0 0 25px;">
                <button class="btn btn-solar px-4" onclick="sendMsg()">
                    <i class="bi bi-send-fill"></i>
                </button>
            </div>

        </div>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
const chatBox = document.getElementById("chatBox");
const userMsg = document.getElementById("userMsg");

function addMessage(sender, text, color) {
    const msg = document.createElement("div");
    msg.className = "mb-2 fade-in";
    msg.innerHTML = `<strong style="color:${color}">${sender}:</strong> ${text}`;
    chatBox.appendChild(msg);
    chatBox.scrollTop = chatBox.scrollHeight;
}

function sendMsg() {
    const text = userMsg.value.trim();
    if (!text) return;

    addMessage("You", text, "#38bdf8");
    userMsg.value = "";

    setTimeout(() => {
        addMessage(
            "Solar AI",
            generateReply(text),
            "#22c55e"
        );
    }, 600);
}

function generateReply(q) {
    q = q.toLowerCase();

    if (q.includes("cost"))
        return "Solar systems have higher initial costs but reduce electricity bills significantly over time.";

    if (q.includes("panel"))
        return "Modern solar panels typically last 25â€“30 years with minimal maintenance.";

    if (q.includes("battery"))
        return "Battery storage allows you to use solar energy at night and during outages.";

    return "I can guide you on solar sizing, savings, pricing, and system selection.";
}

userMsg.addEventListener("keypress", e => {
    if (e.key === "Enter") sendMsg();
});
</script>
{% endblock %}
